function FFSuggest(){var pDebug=false;var pInstanceName='';var pSearchURL='';var pQueryParamName='';var pFormname='';var pLayerName='';var pQueryInput;var pSuggest=new Array();var pLastQuery;var submitted=false;var pShowImages=false;var pCurrentSelection=-1;var pSuggestImageClass='suggestImage';var pSuggestQueryClass='suggestTextQuery';var pSuggestTypeClass='suggestTextType';var pSuggestAmountClass='suggestTextAmount';var pSuggestQueryTypedClass='suggestTextQueryTyped';var pSuggestFooterClass='suggestFooter';var pSuggestHeaderClass='suggestHeader';var pSuggestRowClass='suggestRow';var pSuggestHighlightClass='suggestHighlight';var ptranslation;this.init=function(searchURL,formname,queryParamName,divLayername,instanceName,debugMode,channelParamName,channel,showImages){pSearchURL=searchURL;pFormname=formname;pQueryParamName=queryParamName;pChannelParamName=channelParamName;pChannel=channel;pLayerName=divLayername;pInstanceName=instanceName;pDebug=debugMode;pShowImages=showImages;if(pSearchURL==''){if(pDebug)alert('no searchurl defined');return null;}else if(pInstanceName==''){if(pDebug)alert('no instancename defined');return null;}else if(pFormname==''){if(pDebug)alert('no formname defined');return null;}else if(pQueryParamName==''){if(pDebug)alert('no queryparamname defined');return null;}else if(pLayerName==''){if(pDebug)alert('need a layer for output');}
pQueryInput=document[pFormname][pQueryParamName];jQuery(pQueryInput).keyup(function(ev){handleKeyPress(ev);});jQuery(pQueryInput).keydown(function(ev){return checkTab(ev);});jQuery(pQueryInput).focus(function(){showLayer();});jQuery(pQueryInput).blur(function(){hideLayer();});jQuery(document[pFormname]).submit(function(){return handleSubmit();});ptranslation=new Object();ptranslation['brand']='Hersteller';ptranslation['brand.headline']='Markenvorschl&auml;ge';ptranslation['searchTerm']='Suchbegriff';ptranslation['searchTerm.headline']='Suchvorschl&auml;ge';ptranslation['category']='Kategorie';ptranslation['category.headline']='Kategorievorschl&auml;ge';ptranslation['productName']='Produktname';ptranslation['productName.headline']='Produktvorschl&auml;ge';ptranslation['content']='Inhalt';ptranslation['unspecified']='Sonstiges';}
function handleSubmit(){if(pSuggest[pCurrentSelection]!=undefined){var url=fireSubmitSuggest(pSuggest[pCurrentSelection]);if(url==null){url=pSuggest[pCurrentSelection].searchParams;url=removeParam(url,'format');url=removeParam(url,'_');url=removeParam(url,'omitContextName');url=document[pFormname].action+cutParamsUrl(url);}
window.location=url;return false;}
return true;}
this.handleClick=function(){if(jQuery('li.'+pSuggestHighlightClass).length>0){pCurrentSelection=jQuery('li.'+pSuggestHighlightClass)[0].id.replace(pLayerName+'_','');}
jQuery(document[pFormname]).submit();}
this.handleMouseMove=function(id){unmarkAll();jQuery('#'+pLayerName+' li[id="'+id+'"]').addClass(pSuggestHighlightClass);}
this.handleMouseOut=function(id){jQuery('#'+pLayerName+' li[id="'+id+'"]').removeClass(pSuggestHighlightClass);pCurrentSelection=-1;}
function handleKeyPress(evt){evt=(evt)?evt:((event)?event:null);var keyCode=evt.keyCode;if(keyCode==38){moveUp();}else if(keyCode==27){hideLayer();}else if(keyCode==40){moveDown();}else{if(pQueryInput.value==''){hideLayer();pLastQuery='';return null;}
if(pLastQuery!=pQueryInput.value){getSuggestions();}
pLastQuery=pQueryInput.value;}}
function checkTab(evt){evt=(evt)?evt:((event)?event:null);var keyCode=evt.keyCode;if(keyCode==9){var ovlEl=jQuery('input#'+pQueryParamName+'Underlay');if(ovlEl.length>0){jQuery('input[name='+pQueryParamName+']').attr('value',ovlEl.attr('value'));return false;}}
return true;}
function moveUp(){if(jQuery('li.'+pSuggestHighlightClass).length==0){jQuery('li.'+pSuggestRowClass+':last').addClass(pSuggestHighlightClass);pCurrentSelection=pSuggest.length;}else{var prevEl=jQuery('li.'+pSuggestHighlightClass).prevAll('li.'+pSuggestRowClass);if(prevEl.length==0){jQuery('li.'+pSuggestHighlightClass).removeClass(pSuggestHighlightClass);jQuery('li.'+pSuggestRowClass+':last').addClass(pSuggestHighlightClass);pCurrentSelection=pSuggest.length;}else{jQuery('li.'+pSuggestHighlightClass).removeClass(pSuggestHighlightClass);jQuery(prevEl[0]).addClass(pSuggestHighlightClass);pCurrentSelection--;}}}
function moveDown(){if(jQuery('li.'+pSuggestHighlightClass).length==0){jQuery('li.'+pSuggestRowClass+':first').addClass(pSuggestHighlightClass);pCurrentSelection=0;}else{var nxtEl=jQuery('li.'+pSuggestHighlightClass).nextAll('li.'+pSuggestRowClass);if(nxtEl.length==0){jQuery('li.'+pSuggestHighlightClass).removeClass(pSuggestHighlightClass);jQuery('li.'+pSuggestRowClass+':first').addClass(pSuggestHighlightClass);pCurrentSelection=0;}else{jQuery('li.'+pSuggestHighlightClass).removeClass(pSuggestHighlightClass);jQuery(nxtEl[0]).addClass(pSuggestHighlightClass);pCurrentSelection++;}}}
function cutParamsUrl(param){var qPos=param.indexOf('?');if(qPos>=0){return param.substring(qPos);}else{return param;}}
function removeParam(param,name){var pPos=param.indexOf('?'+name);if(pPos>=0){var f=param.substring(0,pPos);pPos=param.indexOf('&',pPos+1);if(pPos>=0){param=f+param.substring(pPos);}}else{pPos=param.indexOf('&'+name);if(pPos>=0){var f=param.substring(0,pPos);pPos=param.indexOf('&',pPos+1);if(pPos>=0){param=f+param.substring(pPos);}}}
return param;}
function hideLayer(){unmarkAll();jQuery('div#'+pLayerName).hide();fireSuggestLayerHidden();var ovlEl=jQuery('input#'+pQueryParamName+'Underlay');if(ovlEl.length>0){jQuery('input[name='+pQueryParamName+']').css('background-color',ovlEl.css('background-color'));}}
this.hideLayerOutsideCall=function(){hideLayer();}
function showLayer(){jQuery('div#'+pLayerName).show();}
function fireSuggestCompleted(suggestLayerIsVisible){if(typeof(onSuggestCompleted)=='function'){onSuggestCompleted(suggestLayerIsVisible);}}
function fireSuggestLayerHidden(){if(typeof(onSuggestLayerHidden)=='function'){onSuggestLayerHidden();}}
function fireSubmitSuggest(chosenJson){if(typeof(onSubmitSuggest)=='function'){return onSubmitSuggest(chosenJson);}}
function unmarkAll(){jQuery('li.'+pSuggestHighlightClass).each(function(i){jQuery(this).removeClass(pSuggestHighlightClass).addClass(pSuggestRowClass);});}
function htmlEncode(value){return jQuery('<div/>').text(value).html();}
function getSuggestions(){var query=jQuery('input[name='+pQueryParamName+']').attr('value');if(pLastQuery==query){return;}else{pLastQuery=query;}
var requestURL=pSearchURL+'?'+pQueryParamName+'='+encodeURIComponent(query)+'&'+pChannelParamName+'='+pChannel+'&format=jsonp&callback=?&omitContextName=true';jQuery.getJSON(requestURL,function(jsonObj,textStatus){pCurrentSelection=-1;if(jsonObj!=null&&jsonObj.length>0){var outputText='<ul class="'+pLayerName+'Block" onMouseDown="'+pInstanceName+'.handleClick();">';pSuggest=new Array();var lastType='';var tabWord='';query=query.replace(/[^a-zA-Z0-9]/g,"\\\$&");for(var i=0;i<jsonObj.length;i++){if(tabWord==''){var suggestQuery=jsonObj[i].name;if(suggestQuery.toLowerCase().indexOf(query.toLowerCase())==0){tabWord=query+suggestQuery.substring(query.length);}}
var suggestType=jsonObj[i].type;if(suggestType!=lastType){var suggestTypeHead=ptranslation[suggestType+'.headline'];if(!suggestTypeHead){suggestTypeHead=suggestType;}
outputText+='<li class="suggestHeader">'+suggestTypeHead+'</li>';lastType=suggestType;}
var id=pLayerName+'_'+i;if(suggestType=='productName'){outputText+=getSuggestHtml_productName(id,query,jsonObj[i]);}else{outputText+=getSuggestHtml_fallback(id,query,jsonObj[i]);}
pSuggest[i]=jsonObj[i];}
outputText+='</ul>';jQuery('div#'+pLayerName).html(outputText).show();var ovlEl=jQuery('input#'+pQueryParamName+'Underlay');if(ovlEl.length>0){ovlEl.attr('value',tabWord);if(tabWord){jQuery('input[name='+pQueryParamName+']').css('background-color','transparent');}else{jQuery('input[name='+pQueryParamName+']').css('background-color',ovlEl.css('background-color'));}}}else{hideLayer();}}).error(function(e,xhr,settings,exception){if(pDebug){alert('Error:\nHTTP result code: '+e.status+'\nrequested URL: '+requestURL);}});}
function getSuggestHtml_fallback(id,query,jsonSug){var suggestQuery=jsonSug.name;var suggestCount=jsonSug.hitCount;if(suggestCount==0){suggestCount='';}else if(suggestCount==1){suggestCount='1 Treffer';}else{var temp=suggestCount;suggestCount='{0} Treffer';suggestCount=suggestCount.replace(/\{0\}/,temp);}
var html='<li id="'+id+'" class="'+pSuggestRowClass+'" onMouseMove="'+pInstanceName+'.handleMouseMove(\''+id+'\');"'
+'onMouseOut="'+pInstanceName+'.handleMouseOut(\''+id+'\');">'
+'<span class="'+pSuggestQueryClass+'">'+htmlEncode(suggestQuery).replace(new RegExp("("+query+")","ig"),'<span class="'+pSuggestQueryTypedClass+'">$1</span>')+'</span>'
+'<span class="'+pSuggestAmountClass+'">'+suggestCount+'</span>';return html;}
function getSuggestHtml_productName(id,query,jsonSug){var suggestQuery=jsonSug.name;var suggestImageUrl=jsonSug.image;var suggestImage=new Image();suggestImage.onerror=function(){jQuery('#'+this.parentId+' img').first().remove();};if(suggestImageUrl){suggestImage.src=suggestImageUrl;suggestImage.parentId=id;}
var html='<li id="'+id+'" class="'+pSuggestRowClass+' '+pSuggestRowClass+'WithImage" onMouseMove="'+pInstanceName+'.handleMouseMove(\''+id+'\');"'
+'onMouseOut="'+pInstanceName+'.handleMouseOut(\''+id+'\');">'
+'<span class="'+pSuggestImageClass+'">';if(suggestImageUrl){html+='<img src="'+suggestImageUrl+'" alt=""/>';}
html+='</span>'
+'<span class="'+pSuggestQueryClass+'">'+htmlEncode(suggestQuery).replace(new RegExp("("+query+")","ig"),'<span class="'+pSuggestQueryTypedClass+'">$1</span>')+'</span>';return html;}
function onSubmitSuggest(chosenJson){var type=pSuggest[pCurrentSelection].type;if(type=='productName'){var dplnk=pSuggest[pCurrentSelection].attributes['deeplink'];return dplnk;}}}
;function fact_clickProduct(query,artId,artPos,artOrigPos,pageNum,artSimi,sessionId,artTitle,pageSize,origPageSize,channel,eventName,userId){debug=false;request=null;requestUrl='/search/fact-scic.html';requestUrl+='?keywords='+query;requestUrl+='&id='+artId;requestUrl+='&pos='+artPos;requestUrl+='&origPos='+artOrigPos;requestUrl+='&page='+pageNum;requestUrl+='&simi='+artSimi;requestUrl+='&sid='+sessionId;requestUrl+='&title='+artTitle;requestUrl+='&pageSize='+pageSize;requestUrl+='&origPageSize='+origPageSize;requestUrl+='&channel='+channel;requestUrl+='&event='+eventName;if(userId!='')
{requestUrl+='&userId='+userId;}
try{if(window.XMLHttpRequest){request=new XMLHttpRequest();}else if(window.ActiveXObject){request=new ActiveXObject("Microsoft.XMLHTTP");}else{if(debug)alert('no ajax connection');}
if(request!=null){request.open("GET",requestUrl,false);request.send(null);}}catch(ex){if(ex!=undefined){if(debug)alert('Error: '+ex.getmessage);}else{if(debug)alert('Error: '+ex);}}}